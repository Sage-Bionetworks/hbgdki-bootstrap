#!/usr/bin/env python

"""Bootstrap it."""

from hbgdkibootstrap import bootstrap
import synapseclient
import sys
import logging

logger = logging.getLogger(__name__)
logger.setLevel(logging.INFO)

def createSprint(args):
    bootstrap.createSprint(syn=synapseclient.login(silent=True),
                           rally=args.rallyNumber, sprintLetter=args.sprintLetter)

def getRallies(args):
    logger.info("Getting rallies.")
    df = bootstrap.getRallies(syn=synapseclient.login(silent=True),
                              rallyAdminProjectId=bootstrap.RALLY_ADMIN_PROJECT_ID)
    df.to_csv(sys.stdout)

def getSprints(args):
    df = bootstrap.getSprints(syn=synapseclient.login(silent=True),
                              rallyAdminProjectId=bootstrap.RALLY_ADMIN_PROJECT_ID,
                              rallyNumber=args.rallyNumber)
    
    df.to_csv(sys.stdout)

def main():
    import argparse

    parser = argparse.ArgumentParser()

    subparsers = parser.add_subparsers(help='sub-command help')

    parser_create_sprint = subparsers.add_parser('create-sprint', help='Create sprint.')
    parser_create_sprint.add_argument('rallyNumber', type=int, help="The rally number.")
    parser_create_sprint.add_argument('sprintLetter', type=str, help="The sprint letter.")
    parser_create_sprint.set_defaults(func=createSprint)
    
    parser_get_rallies = subparsers.add_parser('get-rallies', help='Get rallies.')
    parser_get_rallies.set_defaults(func=getRallies)
    
    parser_get_sprints = subparsers.add_parser('get-sprints', help='Get sprints.')
    parser_get_sprints.add_argument('--rallyNumber', type=int,
                                    help="The rally number [default: %(default)s].", default=None)
    parser_get_sprints.set_defaults(func=getSprints)

    args = parser.parse_args()
    args.func(args)

if __name__ == "__main__":
    main()
